<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>DeviceHive C++ Framework: Simple gateway example</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="style.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">DeviceHive C++ Framework
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">DeviceHive framework library for C++</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('page_simple_gw.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Simple gateway example </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This simple example aims to demonstrate usage of binary DeviceHive protocol from C++ application.</p>
<p>In terms of DeviceHive framework this example is <b>Gateway</b> implementation:</p>
<div class="image">
<img src="preview2.png" alt="preview2.png"/>
<div class="caption">
DeviceHive framework</div></div>
<p> Our target device is one of small microcontrollers (like <a href="http://www.ti.com/tool/msp-exp430g2" title="TI MSP430 LaunchPad">MSP430</a> development board or <a href="http://www.microchip.com/wwwproducts/Devices.aspx?dDocName=en010243" title="Microchip PIC16F88 microcontroller">PIC16F88</a> based board) which runs microcode and manages the following peripheral:</p>
<ul>
<li>simple LED, allowing user to switch it <em>ON</em> or <em>OFF</em></li>
<li>simple push button, providing user with custom asynchronous events</li>
</ul>
<p>Because of limited resources it's impossible to use RESTful protocol on such small devices. So device uses binary protocol to communicate with an intermediate node - gateway. Gateway is used to convert binary messages to the JSON messages of RESTful protocol and visa versa.</p>
<p>The full source code available in <a class="el" href="simple__gw_8hpp.html" title="The simple gateway example.">examples/simple_gw.hpp</a> file.</p>
<p>It's highly recommended to study <a class="el" href="page_simple_dev.html">Simple device example</a> first.</p>
<p>Please see <a class="el" href="page_start.html">Getting started</a> to get information about how to prepare toolchain and build the <em>boost</em> library.</p>
<h1>Application</h1>
<p>Application is a console program and it's reperented by an instance of <a class="el" href="classsimple__gw_1_1_application.html" title="The simple gateway application.">simple_gw::Application</a>. This instance can be created using <a class="el" href="classsimple__gw_1_1_application.html#a9ff75310716593d5a291ba43c2a96d49" title="The factory method.">simple_gw::Application::create()</a> factory method. Application does all its useful work in <a class="el" href="classbasic__app_1_1_application.html#a13a43e6d814de94978c515cb084873b1" title="Run the application.">simple_gw::Application::run()</a> method.</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span>simple_gw;</div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="namespacesimple__gw.html#a94e3b1617eb11e11e2264c01eff5fdd2" title="The simple gateway application entry point.">main</a>(<span class="keywordtype">int</span> argc, <span class="keyword">const</span> <span class="keywordtype">char</span>* argv[])</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="classsimple__gw_1_1_application.html#a9ff75310716593d5a291ba43c2a96d49" title="The factory method.">Application::create</a>(argc, argv)-&gt;run();</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><h1>Binary message layout</h1>
<p>Each binary message has it's own layout - the binary data format - according to binary protocol specification. Simple, layout is the list of data fields of various types (integers, string, etc.) and it's names. Layout also may be treated as a binary&lt;-&gt;JSON conversion rule.</p>
<p>Message layout is represented by <a class="el" href="classgateway_1_1_layout.html" title="The message layout.">gateway::Layout</a> class. Besides system layouts wich have known format, each endpoint device should provide layout for device-specific messages during registration procedure.</p>
<p>Each message is identified by unique intent number. The <a class="el" href="classgateway_1_1_layout_manager.html" title="The layout manager.">gateway::LayoutManager</a> class manages such intent numbers and corresponding layouts.</p>
<h2>Control flow</h2>
<p>At the start we should send registration request to the target device connected via serial cable. Once we got registration response we register our device on the server using <a class="el" href="classcloud6_1_1_server_module_r_e_s_t.html#a514c33c7597ea6f22e35f2210ad67c86" title="Register the device asynchronously.">simple_gw::Application::asyncRegisterDevice()</a> method.</p>
<p>If registration is successful we start listening for commands from the DeviceHive server using <a class="el" href="classcloud6_1_1_server_module_r_e_s_t.html#aaf6a5b2d91e8cf9e2e5cdc248d9535a1" title="Poll commands asynchronously.">simple_gw::Application::asyncPollCommands()</a> method. Once we received command we convert it from JSON to binary format and send converted command to the device via serial port.</p>
<p>At the same time we listen for notifications from serial port. Once we got notification from device we convert it from binary to JSON format and send converted notification to the DeviceHive server.</p>
<h2>Command line arguments</h2>
<p>Application supports the following command line arguments:</p>
<table class="doxtable">
<tr>
<th>Option </th><th>Description</th></tr>
<tr>
<td><code>--networkName &lt;name&gt;</code> </td><td><code>&lt;name&gt;</code> is the network name </td></tr>
<tr>
<td><code>--networkKey &lt;key&gt;</code> </td><td><code>&lt;key&gt;</code> is the network authentication key </td></tr>
<tr>
<td><code>--networkDesc &lt;desc&gt;</code> </td><td><code>&lt;desc&gt;</code> is the network description </td></tr>
<tr>
<td><code>--server &lt;URL&gt;</code> </td><td><code>&lt;URL&gt;</code> is the server URL </td></tr>
<tr>
<td><code>--serial &lt;serial device&gt;</code> </td><td><code>&lt;serial device&gt;</code> is the serial port name </td></tr>
<tr>
<td><code>--baudrate &lt;serial baudrate&gt;</code> </td><td><code>&lt;serial baudrate&gt;</code> is the serial port baudrate </td></tr>
</table>
<p>For example, to start application run the following command:</p>
<div class="fragment"><div class="line">./simple_gw --serial COM31 --baudrate 9600</div>
</div><!-- fragment --><h1>Make and run</h1>
<p>To build example application just run the following command:</p>
<div class="fragment"><div class="line">make simple_gw</div>
</div><!-- fragment --><p>To build example application using custom toolchain use <code>CROSS_COMPILE</code> variable:</p>
<div class="fragment"><div class="line">make simple_gw CROSS_COMPILE=arm-unknown-linux-gnueabi-</div>
</div><!-- fragment --><p>Now you can copy executable to your gateway device and use it. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri Dec 28 2012 16:00:17 for DeviceHive C++ Framework by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.2 </li>
  </ul>
</div>
</body>
</html>
